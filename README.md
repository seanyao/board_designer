# 板子设计器 (Board Designer)

一个功能完整的基于 Web 的 PC 板设计工具，专为电子工程师和硬件设计师打造。支持创建和管理 M3 孔位组、零件布局、尺寸标注、长度度量等功能，具备直观的网格对齐拖拽、自动保存、文件导入导出等特性。

## ✨ 核心功能

### 🎯 孔位管理
- **M3 孔位组**：创建包含 4 个 M3 标准孔的矩形组
  - 默认边长：20 mm（5 mm 网格对齐）
  - 多色显示：不同孔位组使用不同颜色区分
  - 边长标注：四边实时显示长度（mm）
- **孔位操作**：
  - 单独拖拽：每个孔位可独立移动
  - 整体缩放：拖拽边缘手柄调整组尺寸
  - 删除功能：双击任一孔位删除整组

### 📦 零件布局
- **零件矩形**：创建半透明灰色零件区域
  - 默认尺寸：40 × 30 mm（5 mm 网格对齐）
  - 中心标注：显示"长 × 宽 mm"尺寸信息
- **零件操作**：
  - 整体拖拽：移动零件位置
  - 多向缩放：四角手柄 + 四边手柄调整尺寸
  - 删除功能：双击零件删除

### 📐 尺寸标注系统
- **实时标注**：所有尺寸在拖拽/缩放时自动更新
- **孔位组标注**：四边显示边长（mm）
- **零件标注**：中心显示长宽尺寸（mm）
- **画布标注**：顶部显示宽度，右侧显示高度（mm）

### 🧭 长度度量工具
- **两点测量**：右键菜单选择"创建长度度量"
  - 第一次点击：选择起点
  - 第二次点击：选择终点
- **测量显示**：
  - 虚线连接两点
  - 中点显示精确长度（mm）
  - 网格对齐：起止点自动对齐 5 mm 网格
- **测量编辑**：拖拽端点调整测量位置

### ✏️ 文字标注
- **添加文字**：右键菜单选择"添加文字"
- **文字编辑**：双击文字删除
- **自由定位**：文字可放置在任意位置

### ↔️ 智能缩放系统
- **零件缩放**：
  - 四角手柄：同时调整长宽
  - 四边手柄：单独调整对应边
- **孔位组缩放**：
  - 四边手柄：整体调整矩形尺寸
  - 保持结构：四个孔位始终位于四角
- **网格对齐**：所有缩放操作自动对齐 5 mm 网格
- **边界限制**：缩放受画布范围约束

## 💾 数据管理

### 🔄 自动保存
- **实时保存**：操作后自动保存到浏览器 localStorage
- **启动恢复**：打开页面自动恢复上次设计进度
- **数据键名**：`designer-autosave-v1`

### 📁 文件操作
- **导出设计**：一键导出 JSON 文件
  - 文件名格式：`design-YYYYMMDD-HHMMSS.json`
  - 包含时间戳，便于版本管理
- **导入设计**：选择本地 JSON 文件恢复设计
- **数据格式**：完整的 JSON 序列化，包含所有元素状态

### ⏪ 历史管理
- **撤销/重做**：支持多步操作回退
- **历史栈**：最多保存 100 步操作记录
- **状态快照**：每次操作自动创建状态快照

## 🎨 界面特性

### 🖼️ 视觉设计
- **网格背景**：5 mm 网格，辅助精确对齐
- **多色系统**：6 种循环颜色区分不同孔位组
- **虚线边框**：孔位组和度量线使用虚线表现
- **半透明效果**：零件使用半透明灰色背景

### 🖱️ 交互体验
- **右键菜单**：上下文相关的创建选项
- **拖拽操作**：直观的鼠标拖拽交互
- **键盘支持**：ESC 键取消当前操作
- **网格吸附**：所有操作自动对齐网格

### 🛠️ 工具栏
- **保存到文件**：导出当前设计
- **从文件加载**：导入设计文件
- **清除自动保存**：删除本地缓存
- **恢复自动保存**：从缓存恢复设计
- **撤销/重做**：操作历史管理
- **清空画布**：重置所有内容

## 🚀 使用方法

### 基础操作
1. **打开工具**：在浏览器中打开 `designer.html`
2. **创建元素**：在画布上右键，选择要创建的对象
3. **编辑元素**：拖拽移动位置，拖拽手柄调整尺寸
4. **删除元素**：双击元素确认删除

### 高级功能
1. **长度测量**：右键 → 创建长度度量 → 点击起点 → 点击终点
2. **文字标注**：右键 → 添加文字 → 输入内容
3. **文件管理**：使用左上角工具栏进行保存/加载
4. **历史操作**：使用撤销/重做按钮管理操作历史

## 🧩 技术规格

### 画布设置
- **尺寸**：17 cm × 17 cm
- **网格精度**：5 mm
- **单位换算**：像素到毫米自动转换

### 默认参数
- **孔位规格**：M3 标准孔
- **孔位组边长**：20 mm
- **零件尺寸**：40 × 30 mm
- **最小尺寸**：20 mm（防止过小元素）

### 颜色方案
- **孔位组颜色**：红、蓝、绿、橙、紫、青（循环使用）
- **零件颜色**：半透明灰色 (#808080, 60% 透明度)
- **标注颜色**：黑色背景，白色文字

## 🛠️ 技术实现

### 前端技术
- **纯前端**：HTML5 + CSS3 + JavaScript
- **无依赖**：无需额外框架或库
- **现代标准**：使用现代浏览器 API

### 核心算法
- **网格对齐**：所有坐标自动对齐 5 mm 网格
- **像素转换**：精确的像素到毫米换算
- **状态序列化**：完整的 JSON 状态保存/恢复
- **历史管理**：基于快照的撤销/重做系统

### 数据存储
- **本地存储**：使用 localStorage 进行自动保存
- **文件导出**：使用 Blob API 生成下载文件
- **文件导入**：使用 FileReader API 读取本地文件

## 📁 项目结构

```
designer/
├── designer.html    # 主程序文件（包含所有 HTML、CSS、JavaScript）
└── README.md        # 项目说明文档
```

## 📝 更新日志

### 最新版本
- ✅ **右键菜单系统**：统一的上下文菜单，包含所有创建选项
- ✅ **文字标注功能**：支持添加和编辑文字标签
- ✅ **智能缩放系统**：零件和孔位组的边缘缩放功能
- ✅ **长度度量工具**：两点间距离测量和标注
- ✅ **自动保存系统**：实时保存和历史恢复功能
- ✅ **文件导入导出**：完整的 JSON 格式支持
- ✅ **撤销重做系统**：多步操作历史管理
- ✅ **网格对齐优化**：所有尺寸和间距对齐 5 mm 网格

### 历史版本
- ✅ 创建方式改为右键菜单
- ✅ 新增零件中心尺寸标签
- ✅ 新增边缘缩放功能
- ✅ 默认尺寸改为 5 mm 整数倍
- ✅ 外框尺寸标签显示在框外
- ✅ 自动保存与启动恢复
- ✅ 新增长度度量工具

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request 来改进这个工具：

1. **功能建议**：通过 Issue 提出新功能想法
2. **问题报告**：报告发现的 bug 或问题
3. **代码贡献**：提交 Pull Request 改进代码
4. **文档改进**：帮助完善文档和说明

## 📄 许可证

**MIT License** - 可自由使用、修改和分发

---

**板子设计器** - 让 PCB 设计更简单、更精确！
